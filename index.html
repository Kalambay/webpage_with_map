<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Basic Page Needs–– -->
  <meta charset="utf-8">
  <title>DC Capital Bikeshare</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/customize.css">
  <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
  <style>
    #map_1,
    #map_2,
    #map_3 {
      height: 500px;
    }

    /*
 * The path-start class is added to each line
 * to manage its animation - this interpolates
 * between the starting and ending values for the
 * stroke-dashoffset css property
 */
    .path-start {
      -webkit-transition: stroke-dashoffset 5s ease-in;
      -moz-transition: stroke-dashoffset 5s ease-in;
      -o-transition: stroke-dashoffset 5s ease-in;
      transition: stroke-dashoffset 5s ease-in;
    }
  </style>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <!-- Leaflet HeatMap -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script>

  <!-- arc.js to make paths curved -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/arc.js/v0.1.0/arc.js'></script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>

<body>

  <div class="container one-bottom" style="margin-top: 50px">
    <div class="ten columns">
      <h2>Mobility on Demand Systems: Data-Driven Analysis, Simulation, Visualization</h2>
      <p>
        ARCH 6306/6050, DSBA 6010, ITIS 8010/6010: Wednesdays 6pm-8:30pm, Taught Online
        <br>
        Dr. Dimitris Papanikolaou | dpapanik@uncc.edu | Urban Synergetics Lab | https://urbansynergeticslab.net
      </p>
    </div>
    <div class="two columns">
      <a href="https://urbansynergeticslab.net/"><img class="scale-with-grid" src="img/LabLogo_dark_cropped.png"></a>
    </div>
    <div class="twelve columns">
      <h3>Introduction</h3>
      <p>This webpage is providing visualized information about the bike sharing system in Washington
        DC. The data was captured from <a href="https://www.capitalbikeshare.com"> https://www.capitalbikeshare.com</a>. By analyzing and
        visualizing those data, we are trying to answer questions such as: How the demand for bikes in
        DC changes during a normal weekday on an hourly basis; From where most bike rides usually
        start; What destination the bike users are usually travelling to. The final goal of this analysis is to
        assess the overall performance of the sharing bike system in Washington DC, and propose
        possible solutions to improve the efficiency of the whole system so as to enhance users
        experience. </p>
    </div>
  </div>

  <div class="container one-bottom" >
    <div class="twelve columns">
      <h3>Location of Start of bike trips</h3>
      <h5>
        Stuff about map 1
      </h5>
      <div id="map_1" class="one-bottom"></div>
    </div>
  </div>

  <div class="container one-bottom">
    <div class="twelve columns">
      <h3>Hourly Average of pickups over one week</h3>
      <h5>
        Something about 2 plots
      </h5>
      <div class="row">
        <img class="six columns" src="img/Rplot1.png" alt="">
        <img class="six columns" src="img/Rplot2.png" alt="">
      </div>
    </div>
  </div>


  <div class="container one-bottom">
    <div class="twelve columns">
      <h3>Heat Map and travel paths</h3>
      <h5>
        Somethign about it
      </h5>
      <div class="row">
        <div class="six columns" >
          <b> Metro lines overlayed on a heat map of trip start locations </b>
        </div>
        <div class="six columns" >
          <b> Trip paths overlayed on a heat map of trip start locations </b>
        </div>
      </div>
      <div class="row">
        <div id="map_2" class="six columns"></div>
        <div id="map_3" class="six columns"></div>
      </div>
    </div>
  </div>

  <div class="container one-bottom">
    <div class="twelve columns">
      <h3>Conclusion</h3>
      <h5>Stuff about bike program </h5>
    </div>
  </div>

  <div class="container one-bottom">
    <h2>Team & Contributions</h2>
    <h5>Be very clear about how each student in your team contributed to this project</h5>
    <h3>Student A</h3>
    <h5>Student A contributed to this, this, and that.</h5>
    <h3>Student B</h3>
    <h5>Student B contributed to this, this, and that.</h5>
    <h3>Student C</h3>
    <h5>Student C contributed to this, this, and that.</h5>
  </div>





  <script>
    L.mapbox.accessToken = 'pk.eyJ1IjoiZWhlbGZyaWNoIiwiYSI6ImNra3Zhcmg5MDF1a3YycW55bmttcXA5NWEifQ.A1pr7k28x6Tf3--cUny6tA';

    d3.csv("data/jan_1_2021.csv", function(data) {
      console.log(data);

      var map_1 = L.mapbox.map('map_1')
        .setView([38.896653139857385, -77.03485808499167], 12)
        .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
      map_1
        .scrollWheelZoom.disable();

      data.forEach(function(row) {
          row.start_lat = +row.start_lat;
          row.start_lng = +row.start_lng;
          var path_options = {
            radius: 2,
            color: d3.rgb(88, 206, 227).brighter(),
            stroke: true,
            weight: 1,
          };
          L.circleMarker([row.start_lat, row.start_lng], path_options).addTo(map_1);
        }

      );

      var map_2 = L.mapbox.map('map_2')
        .setView([38.896653139857385, -77.03485808499167], 12)
        .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
      map_2
        .scrollWheelZoom.disable();

      d3.json('https://opendata.arcgis.com/datasets/ead6291a71874bf8ba332d135036fbda_58.geojson', function(error, metro_json) {
        /* console.log(metro_json) */
        L.geoJson(metro_json, {
          style: function(feature) {
            switch (feature.properties.NAME) {
              case 'red':
                return {
                  color: "#eb4034"
                };
              case 'orange':
                return {
                  color: "#ffa600"
                };
              case 'green':
                return {
                  color: "#05f535"
                };
              case 'yellow':
                return {
                  color: "#f2ff00"
                };
              case 'blue':
                return {
                  color: "#1c00f2"
                };
              case 'silver':
                return {
                  color: "#C0C0C0"
                };
            }
          }
        }).addTo(map_2);
      })


      var heat = L.heatLayer([], {
        maxZoom: 12,
        max: 2,
        radius: 10
      }).addTo(map_2);
      data.forEach(function(row) {
        row.start_lat = +row.start_lat;
        row.start_lng = +row.start_lng;
        heat.addLatLng([row.start_lat, row.start_lng]);
      });

      var map_3 = L.mapbox.map('map_3')
        .setView([38.896653139857385, -77.03485808499167], 12)
        .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
      map_3
        .scrollWheelZoom.disable();

      var heat = L.heatLayer([], {
        maxZoom: 12,
        max: 2,
        radius: 10
      }).addTo(map_3);
      data.forEach(function(row) {
        row.start_lat = +row.start_lat;
        row.start_lng = +row.start_lng;
        heat.addLatLng([row.start_lat, row.start_lng]);
      });

      // Transform the short [lat,lng] format in our
      // data into the {x, y} expected by arc.js.
      function obj(ll) {
        return {
          x: ll[1],
          y: ll[0]
        };
      }
      i = 0;
      data.forEach(function(row) {
        try {
          var generator = new arc.GreatCircle(
            obj([row.start_lat, row.start_lng]),
            obj([row.end_lat, row.end_lng])
          );
          /*console.log([row.start_lat, row.start_lng]);
          console.log([row.end_lat, row.end_lng]);*/
          var line = generator.Arc(100, {
            offset: 10
          });
          // Leaflet expects [lat,lng] arrays, but a lot of
          // software does the opposite, including arc.js, so
          // we flip here.
          /*console.log(line.geometries[0].coords);*/
          var newLine = L.polyline(line.geometries[0].coords.map(function(c) {
              return c.reverse();
            }), {
              color: '#fff',
              weight: 1,
              opacity: 0.5
            })
            .addTo(map_3);
          var totalLength = newLine._path.getTotalLength();
          newLine._path.classList.add('path-start');
          // This pair of CSS properties hides the line initially
          // See http://css-tricks.com/svg-line-animation-works/
          // for details on this trick.
          newLine._path.style.strokeDashoffset = totalLength;
          newLine._path.style.strokeDasharray = totalLength;
          // Offset the timeout here: setTimeout makes a function
          // run after a certain number of milliseconds - in this
          // case we want each flight path to be staggered a bit.
          setTimeout((function(path) {
            return function() {
              // setting the strokeDashoffset to 0 triggers
              // the animation.
              path.style.strokeDashoffset = 0;
            };
          })(newLine._path), i * 100);
          i++;
          /*console.log(i);*/
        } catch (err) {
          console.log(err)
        }
      });

    });
  </script>


</body>

</html>
