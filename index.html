<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs–– -->
  <meta charset="utf-8">
  <title>Your Project Title</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/customize.css">
  <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
  <style>
  #map_1,#map_2,#map_3 {
    height: 500px;
  }
  /*
 * The path-start class is added to each line
 * to manage its animation - this interpolates
 * between the starting and ending values for the
 * stroke-dashoffset css property
 */
.path-start {
  -webkit-transition:stroke-dashoffset 5s ease-in;
     -moz-transition:stroke-dashoffset 5s ease-in;
       -o-transition:stroke-dashoffset 5s ease-in;
          transition:stroke-dashoffset 5s ease-in;
  }
  </style>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v4.min.js"></script>

  <!-- Leaflet HeatMap -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script>

  <!-- arc.js to make paths curved -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/arc.js/v0.1.0/arc.js'></script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>
<body>

  <div class="container one-bottom" style="margin-top: 50px">
    <div class="ten columns">
      <h2>Mobility on Demand Systems: Data-Driven Analysis, Simulation, Visualization</h2>
      <p>
        ARCH 6306/6050, DSBA 6010, ITIS 8010/6010: Wednesdays 6pm-8:30pm, Taught Online
        <br>
        Dr. Dimitris Papanikolaou | dpapanik@uncc.edu | Urban Synergetics Lab | https://urbansynergeticslab.net
      </p>
    </div>
    <div class="two columns">
      <a href="https://urbansynergeticslab.net/"><img class="scale-with-grid" src="img/LabLogo_dark_cropped.png"></a>
    </div>
    <div class="twelve columns">
      <h3>Making an interactive map and plotting data on it</h3>
      <h5>Use this template for your assignments in the class. This example uses <a href="https://docs.mapbox.com/mapbox.js/api/v3.3.1/">MapBox.js v3.3.1</a> and <a href="http://getskeleton.com/">Skeleton</a> boilerplate </h5>
    </div>
  </div>

  <div class="container one-bottom" >
    <div class="twelve columns">
      <h3>Example 1: Simple Map</h3>
      <h5>
        This example shows how to create a map using Leaflet.js and MapBox.js, and center the map at a specified pair of lat/long coordinates.
      </h5>
    </div>
  </div>

  <div id="map_1" class="one-bottom"></div>


  <div class="container one-bottom" >
    <div class="twelve columns">
      <h3>Example 2: Map with displayed locations of stations from a dataset</h3>
      <h5>
        This example shows how to create a map using Leaflet.js/MapBox.js, and then plot a set of circles at the locations of the stations.
      </h5>
    </div>
  </div>

  <div id="map_2" class="one-bottom"></div>


  <div class="container one-bottom" >
    <div class="twelve columns">
      <h3>Example 3: Map with locations of stations with sizes proportional to their accumulation levels</h3>
      <h5>
        This example shows how to create a map using Leaflet.js/MapBox.js, plot a set of circles at the locations of the stations, and adjusts their diameters to be proportional to the inventory levels of the stations.
      </h5>
    </div>
  </div>


  <div id="map_3" class="one-bottom"></div>


  <div class="container one-bottom" >
    <h3>Below is an array of images organized into rows and collumns</h3>
  </div>

  <div class="container one-bottom" >
    <div class="row">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
    </div>
    <div class="row">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
      <img class="four columns scale-with-grid quarter-bottom-rel" src="img/img_640/640x480.jpg">
    </div>
  </div>

  <div class="container one-bottom" >
    <h2>This is Heading 2</h2>
    <h3>This is Heading 3</h3>
    <h4>This is Heading 4</h4>
    <h5>This is Heading 5</h5>
    <p>This is paragraph text p</p>
  </div>

  <div class="container one-bottom" >
    <h2>Team & Contributions</h2>
    <h5>Be very clear about how each student in your team contributed to this project</h5>
    <h3>Student A</h3>
    <h5>Student A contributed to this, this, and that.</h5>
    <h3>Student B</h3>
    <h5>Student B contributed to this, this, and that.</h5>
    <h3>Student C</h3>
    <h5>Student C contributed to this, this, and that.</h5>
  </div>



  <script>

  L.mapbox.accessToken = 'pk.eyJ1IjoiZWhlbGZyaWNoIiwiYSI6ImNra3Zhcmg5MDF1a3YycW55bmttcXA5NWEifQ.A1pr7k28x6Tf3--cUny6tA';

  d3.csv("data/jan_1_2021.csv", function(data) {
  console.log(data);

  var map_1 = L.mapbox.map('map_1')
    .setView([38.896653139857385, -77.03485808499167], 9)
    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
  map_1
    .scrollWheelZoom.disable();

  data.forEach(function(row) {
    row.start_lat = +row.start_lat;
    row.start_lng = +row.start_lng;
    var path_options = {
      radius: 2,
      color: d3.rgb(88, 206, 227).brighter(),
      stroke: true,
      weight: 1,
    };
    L.circleMarker([row.start_lat, row.start_lng], path_options).addTo(map_1);
  }

);

  var map_2 = L.mapbox.map('map_2')
    .setView([38.896653139857385, -77.03485808499167], 12)
    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
  map_2
    .scrollWheelZoom.disable();

  var heat = L.heatLayer([], { maxZoom: 12, max: 2, radius: 10 }).addTo(map_2);
  data.forEach(function(row){
    row.start_lat = +row.start_lat;
    row.start_lng = +row.start_lng;
    heat.addLatLng([row.start_lat, row.start_lng]);
  }
);

var map_3 = L.mapbox.map('map_3')
  .setView([38.896653139857385, -77.03485808499167], 12)
  .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v10'));
map_3
  .scrollWheelZoom.disable();

  var heat = L.heatLayer([], { maxZoom: 12, max: 2, radius: 10 }).addTo(map_3);
  data.forEach(function(row){
    row.start_lat = +row.start_lat;
    row.start_lng = +row.start_lng;
    heat.addLatLng([row.start_lat, row.start_lng]);
  }
);

  // Transform the short [lat,lng] format in our
  // data into the {x, y} expected by arc.js.
  function obj(ll) { return { x: ll[1], y: ll[0] }; }
i = 0;
data.forEach(function(row){
  try {
    var generator = new arc.GreatCircle(
      obj([row.start_lat, row.start_lng]),
      obj([row.end_lat, row.end_lng])
    );
    console.log([row.start_lat, row.start_lng]);
    console.log([row.end_lat, row.end_lng]);
    var line = generator.Arc(100, { offset: 10 });
    // Leaflet expects [lat,lng] arrays, but a lot of
    // software does the opposite, including arc.js, so
    // we flip here.
    console.log(line.geometries[0].coords);
    var newLine = L.polyline(line.geometries[0].coords.map(function(c) {
        return c.reverse();
    }), {
        color: '#fff',
        weight: 1,
        opacity: 0.5
    })
    .addTo(map_3);
    var totalLength = newLine._path.getTotalLength();
    newLine._path.classList.add('path-start');
    // This pair of CSS properties hides the line initially
    // See http://css-tricks.com/svg-line-animation-works/
    // for details on this trick.
    newLine._path.style.strokeDashoffset = totalLength;
    newLine._path.style.strokeDasharray = totalLength;
    // Offset the timeout here: setTimeout makes a function
    // run after a certain number of milliseconds - in this
    // case we want each flight path to be staggered a bit.
    setTimeout((function(path) {
        return function() {
            // setting the strokeDashoffset to 0 triggers
            // the animation.
            path.style.strokeDashoffset = 0;
        };
    })(newLine._path), i * 100);
    i++;
    console.log(i);
  }
  catch(err) {
    console.log(err)
  }
});

});




  </script>


</body>
</html>
